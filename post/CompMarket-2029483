发信人: RonLiang (俩零|戒网), 信区: CompMarket<br />标  题: 浅析PC硬盘（零件提供商以及硬盘的性能）<br />发信站: 水木社区 (Wed Jan 30 01:01:04 2008), 站内<br /><br /><br />浅析PC硬盘（零件提供商以及硬盘的性能）<br /><br />欢迎转载，但请保留版权信息：RonLiang@newsmth。<br />不足之处欢迎讨论。顺便给大家拜个早年。:)<br /><br />硬盘作为电脑中的数据存储的核心，和当前整机性能的“最短的一块木板”，其地位不用我多说，介绍硬盘的历史、结构之类的文章网上也相当多了。这里主要是换个角度跟大家聊一聊硬盘的一些内容。先说说硬盘的各个组件，然后说说现在的硬盘评测方面的内容。零散的会提及其他的部分。希望本文可以让大家日后对硬盘的产业有进一步的了解，以及日后在看硬盘评测的时候，不完全是抱着一种赌赛马的心态来看各项测试的胜负。<br /><br />从硬盘厂商来说，现在3.5寸硬盘市场分额最大的是希捷，之后依次是西部数据、日立、三星。2.5寸这块分额最大的是日立。1.8寸硬盘份额最大的是东芝（拜苹果的iPod所赐）。希捷和西部数据都在盈利，日立一直在亏，亏得开始和别的日系厂商谈整合了。<br /><br />硬盘主要的核心部件基本上是：盘片和磁头；以及硬盘的控制电路。这三个基本上可以决定一个硬盘的技术水准和特性。这三个关键部件各有各的情况。<br /><br />先说磁头。磁头提供商主要分成两类，一类是硬盘厂商自产磁头，一类是向这些硬盘厂商提供磁头的第三方磁头厂商。本来呢，给别人提供磁头的厂商有IBM，Read-Rite，SAE(TDK旗下)和ALPS这几家。IBM被日立收购之后，就只给日立产磁头了。希捷是几乎所有的磁头都是自己产的。西部数据本来是向第三方购买磁头的。在03财年收购了破产了的Read-Rite之后，也在渐渐的扩大自家的磁头产能，减少向第三方的订货，现在基本也已经自给自足。ALPS又因为希捷收购了Maxtor，丢了Maxtor这个大客户，只好被TDK收购了。所以现在第三方磁头厂TDK硕果仅存，还好有三星、富士通和东芝这三家硬盘厂的单子（其中富士通在04年和TDK整合了双方在新加坡的业务，以TDK为主导）。尽管如此，因为WD的订单的减少，尽管现在硬盘市场整体在增长，但TDK的磁头业务却在小幅地萎缩（07财年相比06财年销售萎缩了 3.5%）。<br /><br />再说盘片。盘片是在基底上作表面处理，做上一层合金的存储介质。盘片的基底现在主要是两类，一类是铝制，一类是玻璃材质。现在3.5寸基本都是铝制盘片，2.5以及以下基本上是玻璃盘片。今年关于硬盘盘片厂商的新闻，最大的莫过于西部数据收购Komag。这个Komag是目前世界上最大的盘片提供厂商之一。这还是一个曾经破产过的企业，重组之后，把工厂从美国都转移到马来西亚，近几年发展的非常快。绝大部分业务是3.5寸的盘片，客户包括希捷、西部数据、日立(HGST)。另一个主要的独立盘片厂商是昭和电工(Showa Denko KK)，07年率先量产334G单碟3.5寸盘片的厂商。最早的工厂设在日本千叶县，后来收购三菱化学的硬盘业务，接收了后者的新加坡工厂。03年的时候又通过技术输出的合作形式，将台湾的和乔科技（Trace）实质上变成自己的代工厂。除了这两个重量级独立盘片厂之外（被WD收购之后就只剩一位了），另外的盘片厂商都是日系企业，包括富士电子、HOYA（豪雅？保谷？呵呵，总之是那个加工玻璃的厂商）等等。<br /><br />再说硬盘厂商自己的盘片生产。WD本来自己没有盘片生产这块业务，主要向Komag和昭和电机购买盘片（Fuji和HOYA也是有份的）。现在借收购Komag之后，一举成为有相当实力的盘片生产企业，今后可以逐步将自己的订单转移到自己的工厂来。日立收购了家大业大的IBM硬盘业务，自然也承接了IBM相当大的盘片产能。希捷一贯的自产自销。不过希捷的模式有些特殊，希捷大部分的盘片是向第三方独立盘片厂外购盘片的基底（70%的铝盘和全部的玻璃盘），然后在自己的北爱尔兰工厂加工成最终的盘片。其中不少部分来自被WD收购了的Komag（希捷的这部分单子肯定要逐步转移了）。希捷在马来西亚也在建盘片厂，扩大自己的盘片生产能力。希捷在收购Maxtor的时候，还接收了Maxtor的盘片工厂MMC，Maxtor刚刚从Hyundai Electronics America (现在的Hynix Semiconductor America)手里收购的工厂。<br /><br />讲到这里，硬盘的磁头和盘片基本上说得差不多了。再回过头来看一些事情，就会有一些新的结论。比如三星率先推出334G单碟的技术的时间，和昭和电机量产334G单碟盘片，TDK同时提供配套磁头的时间相当的接近。<br /><br />接着说说硬盘的控制电路。这部分电路的设计一般都是各个硬盘厂商完成的。但芯片的设计和生产却都是第三方的芯片公司。现在各家的主控芯片均采用SoC设计，一个芯片集成了多项功能。主控芯片主要分为如下几个功能模块：读取通道(read channel)（将从盘片传过来的带噪声的模拟信号转变成处理过的数字信号的电路），ARM之类的嵌入式微处理器，SATA(SAS)的PHY界面，硬盘的控制逻辑，缓存控制器（甚至内置缓存）等等。基本上除了部分磁头控制功能还需要单独的芯片之外，其它功能都被集成到主控芯片上了。今年各厂商推出的新一代的控制器不少都具备了6G的SATA界面，超过3G的读取通道带宽（每代芯片读取通道的带宽一般要低于PHY带宽速度不少），以及65nm的工艺技术（目前市场上的SoC主控芯片以90nm工艺为主，部分65nm的），将用在下一代硬盘产品中。可以说，主控芯片以及其Firmware的设计，是一个硬盘功能、性能、兼容性、噪音、功耗等指标的关键因素之一，有的甚至最主要的因素。现在为硬盘厂商提供主控SoC芯片的公司主要有：LSI（收购了Agere的HDD芯片设计部门，现在多见于希捷的硬盘），marvel（马威尔，其HDD芯片多见于西部数据、三星），意法半导体（ST）（部分希捷、西数），英飞凌（和日立有极为紧密的联系）。硬盘厂商参与芯片的设计，但芯片设计和制作的主导都是这些第三方芯片厂商。<br /><br />再提一下硬盘主轴电机的生产厂商，这个领域基本上是日本厂商的天下。Nidec、Matsushita-Kotobuki、NMB(Minebea)等日系企业几乎垄断了这个市场。硬盘厂商向这些电机厂商购买主轴电机。<br /><br />讲到这，硬盘的主要部件基本上的提供商的内容就讲的差不多了。基本上是合并越来越多，竞争越来越激烈。接下来说一说目前的硬盘的性能以及评测手段。顺便讨论一下现在各个品牌的产品。<br /><br />在这一部分，我首先介绍一下一些硬盘的评测网站，本文的一些数据和观点基本上从这些网站中引出的。<br />首先是storagereview，网址是http://www.storagereview.com/  差不多是所有网站里面最专业的。<br />其次是tomshardware、xbitlabs、以及anandtech。<br />然后是国内的存储时代stor-age。<br />强烈推荐storagereview上的Reference Guide，<br />http://www.storagereview.com/guide/index.html<br />内容非常的翔实全面，基本上应有尽有。<br /><br />首先，影响硬盘性能的因素非常得多。例如硬盘的性能不但取决于硬盘本身，还与硬盘控制器密切相关。不同的硬盘控制器下的结果是有一定的差异的。所以我们比较硬盘的速度，是必须在同一平台同一设置才有严格的意义。并且还要标明文件系统的格式等相关信息。<br /><br />硬盘最低层的指标有两类，一类是传输率，一类是寻道。<br /><br />先说传输率。传输率有三种，一种是internal media transfer rate，这是指磁头从盘片上读取单个磁道时候的绝对数据传输率，单位是Mb/s，受磁道位置影响。日立习惯于标这个数据。列一下storagereview上的公式：<br />User Data Transfer Rate = (Spindle Speed / 60 * Sectors Per Track * 512 * 8) / 1,000,000<br />由于这个数据很不直接，也没什么性能上的意义，所以一般很少提到这个。<br /><br />另一种是内部持续传输率Internal Sustained Transfer Rate。storagereview上的公式：<br />STR = (Number of surfaces * Sectors per track * 512) / ( 2 * Number of surfaces * Latency + (Number of surfaces - 1) * Head Switch Time + Cylinder Switch Time)<br />这个数据就是大多数人最常用软件测试、比较的项目。<br /><br />再一个是外部的接口速率。是指理论上的接口带宽（比如SATA300/SATA150）。这个的意义对于硬盘来说并不直接，而且对同一代的硬盘来说没有区分。所以一般也不比较这个。有一个类似的指标，是实测的接口速率，缓存到接口之间的数据传输速度。这个跟控制芯片的设计和固件设置是密切相关的。这个指标各个厂家甚至产品系列之间都有差别，在部分情况下（比如反复调用某个小文件的病毒扫描应用）还是有很明显的性能影响。<br /><br />这里重点讨论一下内部传输率指标，因为这个指标几乎成了衡量硬盘性能的“唯一标准”了。测试这个指标的软件有很多。最专业的是H2benchw，另外ATTO、HD Tach、Winbench99和HD tune等软件都能测持续传输率。这个指标反映了硬盘的的磁道顺序读取的性能，同转速硬盘的比较基本上是单碟容量大的有很大的优势。如果买硬盘是主要用来做大文件的存储和转换，保证不产生多少磁盘碎片，那这个性能指标是最为关键的。但在服务器应用以及个人日常应用的时候，持续传输率这个指标的作用极为有限。<br /><br />另一类的硬盘底层指标是寻道性能。我们实际上用软件测试的是访问时间(Access time)。根据storagereview的公式，<br />Access Time = Command Overhead Time + Seek Time + Settle Time + Latency<br />其中主要的是寻道时间(Seek Time)，数值上是磁头在任意两个磁道之间寻址的时间的平均值（最小是相邻磁道寻址，最坏是最外圈和最内圈之间的寻址），这个数值厂商一般是给出的，反映的是盘片的大小和磁头寻道运行的速度。但是对用户来说是测不到的，用户只能看到比寻道时间大一些的访问时间。Command Overhead Time是指令发出到硬盘部件实际开始运作的时间；Settle Time是磁头移到相应磁道柱面之后，到位置基本稳定的时间；Latency是指盘片上相应的数据(sector)转到磁头正下方，磁头需要的等待时间，对7200转硬盘来说，平均4.2ms。在访问时间中，主要的是寻道时间和Latency。<br /><br />理论上，寻道速度越快的硬盘，处理大量的细小文件的速度就越快。但在性能上，高转速的硬盘会对低转速的硬盘有这方面的性能优势，但同转速的硬盘之间的访问时间都基本相似。在同转速硬盘之间，寻道速度一般不是引起性能差异的主要因素。<br /><br />传输率和寻道性能是硬盘最底层的性能指标。硬盘还有一个比较底层的性能指标是硬盘的随机访问性能。一系列文件大小不同（但都不大），访问的磁道位置不同，出现的次序不同的一组随机数据的压力下硬盘的性能，一般用每秒完成的IO个数来衡量（也有用每秒钟完成的数据传输量的）。IOmeter这个软件就是衡量这个性能的好工具。<br /><br />IOmeter最初是由Intel开发，在Intel放弃更新之后，由开源组织来作后续的开发。<br />网址: <br />http://sourceforge.net/projects/iometer/<br />IOMeter可以自己定制测试的模式，常见的IOmeter的测试模式有四种：文件服务器File Server；网页服务器Web server；工作站Workstation；数据库Database。分别以四种不同的数据、读写组合来测量不同数据队列长度下硬盘每秒钟处理IO的个数。这个数据越大越好。<br />四种模式具体的差异可以看这里：<br />http://www.storagereview.com/articles/200003/20000313OSandBM_5.html<br />总的来说，文件服务器模式和网页服务器模式的差异在于文件服务器的测试有读操作也有写操作；而网页服务器的模式是纯读的。工作站和数据库模式下，随机的模式比服务器模式单一，都是8K以上大小的文件读写，以大小为8K的文件为主（80%），而服务器模式是有8K以下大小的文件的，而且4K占总量的最多比例。工作站模式和数据库模式下均有读写操作，但数据库模式下写操作的比例相比稍大一点。因此，文件服务器模式和网页服务器模式下结构的差异，以及工作站模式和数据库模式在数据结果上的差异，都是读性能和写性能之间的强弱对比。<br />因此就这四种模式来说，服务器模式相比工作站模式和数据库模式更能体现硬盘的随机读写性能（4K为主的数据比8K为主的数据在当前更有实际意义，而且服务器模式下的数据随机性更强），而网页服务器的纯读操作一般也不认为符合当前网页服务器的实际情形。所以四种模式里面，最有代表意义的，还是File server这个模式。<br />说到这里，还有一件事。国内的存储时代在测试7200.11和ES2的时候，分别比较了IOMeter下纯读取随机访问性能和Web Server性能，然后在后面特意指出，这两个测试的结果几乎一致，不得不令人汗一下。<br />IOmeter这个测试，由于数据的高度随机性，所以体现了硬盘的随机访问的IO性能。同时因为测试硬盘在不同的数据队列长度下的IO性能，也是测试NCQ/TCQ这类高级功能的良好测试。对于大量数据的服务器场合，这个测试还是有很好的参考意义。<br /><br />以上的几种测试模式都是为考察硬盘的特定性能而产生的测试。目的单一，而且比较底层。距离大多数的实际应用场合都比较远。毕竟买硬盘来 整天只做大文件操作，或者整天整个硬盘拿来做负担较重的服务器，而且访问纯随机的情形是少数。而一般的操作，比如病毒扫描，比如开机关机，比如游戏载入，比如处理大量压缩文件等等的实际操作，而这些操作，都是有相对固定的模式的。比如队列长度一般不长，以1为主；访问的磁道区域相对集中；各种大小数据的比例相对固定等等。这个时候，硬盘的控制器和固件的高级策略就开始表现出来强大的作用了。往往会呈现出一个不同于底层性能测试的结果。<br /><br />这类测试硬盘在实际日常操作中的性能的测试，有点像显卡中3Dmark中的几个场景测试，是得出3Dmark成绩的部分，或者类似用实际游戏来看显卡的帧数。而之前的底层性能测试，有点类似3Dmark中后面那些填充率之类的分项测试。在硬盘的测试里面，这类模拟日常操作的测试基本不受大家重视，大家拿来比较硬盘性能的反而是持续传输率这个单项测试，而且一般采用的软件也很不专业。某种程度上也是怪好笑的。<br /><br />这类模拟硬盘实际操作性能的测试一共有两类，一类是真正的程序在做测试。比如真的用WinRAR来处理一定量的文件；比如一些知名游戏的载入时间等等。但这样的测试不好量化，不好对比；过程中会涉及到一些别的因素，例如CPU、内存等等；而且每次做这种测试，每次的具体过程并不会是严格一致的，所以可重复性一般。优点在于，这样的测试种类可以很灵活。Anandtech的测试中经常包含这一类测试。<br /><br />另一种是专门的软件来模拟这类操作。原理上是由一些专门的软件，来记录一些日常硬盘压力大的应用的实际操作对硬盘的动作，例如数据的长度和顺序、各数据寻道的距离、产生的数据队列长度等等。然后用特定的程序来专门复现这些操作。然后用每秒钟完成的IO数字来做成绩。这种测试的基本上可以克服上一类办法的缺点，容易量化，几乎不受CPU等性能的影响，重复性好，而且可以把类似的操作组合起来作为一个综合性更强的测试。<br />这类模拟真实操作的测试，代表性较强的一个是PCMark系列的硬盘测试；一个是StorageReview自己的DriveMark系列。<br /><br />PCmark现在已经历经PCmark04; PCmark05和着重测试Vista下性能的PCmark Vantage三个版本，FutureMark网站上的各软件的白皮书中有一些各项测试的原理和内容的介绍；而DriverMark的结果只能在StorgeReview网站上查阅，软件并不提供下载。详细测试原理在该网站上有说明。网址：http://www.storagereview.com/Testbed4.sr?page=0%2C2<br /><br />不同的测试项目的读取所占比例、文件大小分布等等是有不小差异的，所倚重的硬盘的特性也是不同的。<br /><br />而影响这些实际应用的性能的指标是哪些呢？不是持续传输率，因为这类测试的性能排名和持续传输率的排名基本不一样；是访问时间？也不是。各个转速相同的硬盘之间的访问时间往往差别并不大，而且也不是访问时间最短的这类测试的性能就越好。那是IOMeter的结果？也不是。和持续传输率指标一样的不怎么相关。在这里，硬盘控制器和硬盘控制器固件的作用被表露得淋漓尽致。可以说同代硬盘在实际应用程序中的性能高低的比拼都在这里了。<br /><br />对一些特定情形做的在控制器、在固件上的优化，例如对日常应用的主流，localized data access的优化，也是硬盘厂商大量花费精力的地方之一。硬件基本一致的希捷7200.11和ES2，因为固件的不同，导致了ES2的性能的大幅领先；西数的7500AYYS和7500AAKS也有类似的现象（而日立的企业版和普通桌面版在这方面的差别相对不明显，期待三星的企业级硬盘的表现的测试了）。<br /><br />介绍完这类模拟硬盘实际操作的性能测试之后，大体各类测试的意义就差不多都说明了。我们来看一下近期的一些硬盘在各项测试的表现。<br /><br />先说希捷的7200.11和ES2。应该说希捷这一代的硬盘在性能上是有相当大的进步。以前只有持续传输率一项能拿得出手（由于这一项测试往往是大家自己测试硬盘性能的唯一指标，所以不少人会认为希捷的硬盘之前的性能也十分的好）。现在借由NCQ功能的完善，在IOMeter的测试也有了长足的进步（之前的希捷曾经有过开了NCQ之后队列性能没有多少提升的事情，可谓将NCQ噱头化的笑话。虽然7200.11和ES2的NCQ性能仍整体不及7500AYYS，但也算是出类拔萃了）。但是新一代的硬盘在实际的应用测试中依然表现平平甚至有些测试还会垫底。希捷在这方面的工作还远远不够。近期希捷的7200.11还爆出和Intel南桥的兼容性问题，还有缓存方面的问题，谁之过？LSI？还是Seagate？<br />要说希捷最近问题出得也并不少了，之前的NForce4兼容性问题之类的，曾经具有歇斯底里的声音的业界第一款单碟100G的200G SATA之类的，诡异的新固件的性能（这个地方确实要用诡异来形容，如果之前的固件版本没什么问题的话是没必要推出新版本的，新版本固件的持续传输率指标的波动还是值得寻味的）。质保上水货盘OEM盘之类的也没少出，性能上也实在看不出好来，价格也基本上最贵，但就是有最多的粉丝和最好的销量。真有点硬盘第一大厂的派头，不服不行。有点像主板里面的华硕，就是再缩水的板子也好卖，再多的问题也是华硕，卖得比别人再贵也是值得的。<br /><br />然后再说西部数据的GreenPower。这个系列的硬盘以低功耗为卖点。而低功耗的实现却相当一部分成分是由降低硬盘转速来实现的。因为如果转速是随负载可变的话，作用只能是增加功耗而不是降低功耗。好不容易盼来了西部数据的250G单盘，却发现买不到7200转的产品了。呵呵。何其诡异。降低功耗是好事，但性能上牺牲的有点多了吧，看人家P7K500，人家不用降低转速，节能效果也差不多。<br /><br />再说日立。日立的7K1000/A7K1000系列的硬盘，五张盘实现1T，盘片数多了点。而且功耗和噪音都很一般(但也不算是差的那一类)。但日立的近几代硬盘有个特点，尽管一些低层的测试不拔尖，但每每却能在模拟实际应用的测试中的绝大多数项目有出色的表现，强于绝大多数同时代对手，例如游戏载入之类的应用（西部数据的几个企业级的型号也有类似的优势，例如现在的7500AYYS和曾经的5000YS，但稍微没有日立的突出），这个和日立的控制器以及固件的优化方向有关。日立在日常应用的性能方面，用200G单碟的技术压倒了250G单碟的希捷和西数。<br /><br />三星的F1系列，这个系列的意义在于向我们展示了334G单碟的硬盘在持续传输率上的优势。而三星相对希捷稍好的对实际应用的优化，也让F1有足够的实力暂时在性能上有较高的整体水准。（拜Marvel所赐？这个悬疑）<br /><br />最后补充一下硬盘缓存对硬盘性能的影响。这个其实也跟不同硬盘的缓存控制的设计设置是相关的。一般来说，硬盘的写缓存对小文件写入的速度影响是很大的。硬盘的读缓存作用就相对较小。毕竟现在硬盘缓存相对其存储的数据量来说简直是太小了，而且是只有在一些特殊的应用中才会有足够多足够小的常用文件来起到缓存的加速作用；读缓存的预读取功能也仅仅是让持续传输率曲线稍微平滑一点，但对绝对数值基本不会有任何影响。<br /><br />文章写到这里差不多就要结束了。最后要说的是，硬盘的性能是个很复杂的事情。而且不同的硬盘的的特点也是相异的。不同的应用下表现最好的硬盘也是不同的，如果在意性能的话，最好找所需要的应用的对应的测试来确定到底哪个型号的硬盘在自己的应用中性能最好。最不该的是只用一些很业余的软件跑持续传输率的测试，实在觉得麻烦的话还不如比较PCMark的HDD项目的成绩。其实对大多数用户来说，硬盘的性能并不重要，而且是同时代推出的硬盘性能就是有差距，也都不明显；现在推出的硬盘性能再好，也比不上两三年后的推出来硬盘的性能。因此对大多数用户来说，更应该更多的关注硬盘的质量、噪音、功耗等方面的特性（恐怕这个观点也是西部数据敢于将250G单碟这一代的宝都压在较低转速的GreenPower系列硬盘的原因之一吧，毕竟比早一代的产品还是并没有多少劣势的）。<br /><br />本文在成文过程中引用了相当多的StorgeReview的数据和观点，<br />以及各个厂商的年报内容，在此一并致谢。<br /><br />（全文完）<br /><br />--<br /><br />真诚到永远<br /><br /><br />※ 修改:・RonLiang 于 Jan 30 01:35:16 修改本文・[FROM: 211.99.222.*]<br />※ 来源:・水木社区 http://newsmth.net・[FROM: 166.111.77.*]